openapi: 3.1.0
info:
  title: Notion Course Creator API
  description: API pour créer des cours structurés dans Notion.
  version: 2.1.0
servers:
  - url: https://notion-course-api.onrender.com

paths:
  /health:
    get:
      operationId: healthCheck
      summary: Vérifier le statut de l'API
      responses:
        '200':
          description: OK

  /api/search:
    post:
      operationId: search
      summary: Rechercher pages et databases dans Notion
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                query:
                  type: string
      responses:
        '200':
          description: Résultats de recherche

  /api/search-pages:
    post:
      operationId: searchPages
      summary: Rechercher uniquement des pages
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                query:
                  type: string
      responses:
        '200':
          description: Pages trouvées

  /api/search-databases:
    post:
      operationId: searchDatabases
      summary: Rechercher uniquement des databases
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                query:
                  type: string
      responses:
        '200':
          description: Databases trouvées

  /api/page/{pageId}:
    get:
      operationId: getPage
      summary: Récupérer une page
      parameters:
        - name: pageId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Page Notion
    patch:
      operationId: updatePage
      summary: Mettre à jour une page
      parameters:
        - name: pageId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                properties:
                  type: object
      responses:
        '200':
          description: Page mise à jour

  /api/page/{pageId}/blocks:
    get:
      operationId: getPageBlocks
      summary: Récupérer le contenu d'une page
      parameters:
        - name: pageId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Blocs de la page

  /api/page/{pageId}/append-content:
    post:
      operationId: appendContent
      summary: Ajouter du contenu formaté à une page existante
      description: Ajoute des blocs formatés (paragraph, info, quiz, etc.) à une page.
      parameters:
        - name: pageId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content:
                  type: array
                  description: Array de blocs au format simplifié
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                      text:
                        type: string
                      items:
                        type: array
                        items:
                          type: string
                      code:
                        type: string
                      language:
                        type: string
                      question:
                        type: string
                      options:
                        type: array
                        items:
                          type: string
                      correctIndex:
                        type: integer
                      term:
                        type: string
                      definition:
                        type: string
                      stepNumber:
                        type: integer
                      instructions:
                        type: array
                        items:
                          type: string
                      solution:
                        type: string
                      minutes:
                        type: integer
      responses:
        '200':
          description: Contenu ajouté avec nombre de blocs
    post:
      operationId: appendContent
      summary: Ajouter du contenu formaté à une page existante
      description: Utilise le même format que create-course. Idéal pour enrichir une page.
      parameters:
        - name: pageId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content:
                  type: array
                  description: Array de blocs au format simplifié (paragraph, info, quiz, etc.)
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                      text:
                        type: string
                      items:
                        type: array
                        items:
                          type: string
                      code:
                        type: string
                      language:
                        type: string
                      question:
                        type: string
                      options:
                        type: array
                        items:
                          type: string
                      correctIndex:
                        type: integer
                      term:
                        type: string
                      definition:
                        type: string
                      stepNumber:
                        type: integer
                      instructions:
                        type: array
                        items:
                          type: string
                      solution:
                        type: string
                      minutes:
                        type: integer
      responses:
        '200':
          description: Contenu ajouté avec nombre de blocs

  /api/database/{databaseId}:
    get:
      operationId: getDatabase
      summary: Récupérer une database
      parameters:
        - name: databaseId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Database Notion

  /api/validate-course:
    post:
      operationId: validateCourse
      summary: Valider un cours avant création
      description: Vérifie la structure et retourne erreurs/warnings sans créer.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [title, sections]
              properties:
                title:
                  type: string
                sections:
                  type: array
                  items:
                    type: object
      responses:
        '200':
          description: Résultat de validation

  /api/dry-run:
    post:
      operationId: dryRunCourse
      summary: Tester la génération d'un cours
      description: Simule la création et retourne les stats sans créer.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [title, sections]
              properties:
                title:
                  type: string
                sections:
                  type: array
                  items:
                    type: object
      responses:
        '200':
          description: Analyse complète

  /api/create-course:
    post:
      operationId: createCourse
      summary: Créer un cours complet dans Notion
      description: Crée un cours avec sections. Supporte markdown dans le texte.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [parentId, title, sections]
              properties:
                parentId:
                  type: string
                  description: ID de la page parent Notion
                title:
                  type: string
                icon:
                  type: string
                cover:
                  type: string
                description:
                  type: string
                estimatedTime:
                  type: integer
                prerequisites:
                  type: array
                  items:
                    type: string
                objectives:
                  type: array
                  items:
                    type: string
                sections:
                  type: array
                  items:
                    type: object
                    required: [title, content]
                    properties:
                      title:
                        type: string
                      description:
                        type: string
                      color:
                        type: string
                      toggleable:
                        type: boolean
                      content:
                        type: array
                        items:
                          type: object
                          properties:
                            type:
                              type: string
                            text:
                              type: string
                            items:
                              type: array
                              items:
                                type: string
                            code:
                              type: string
                            language:
                              type: string
                            caption:
                              type: string
                            url:
                              type: string
                            icon:
                              type: string
                            color:
                              type: string
                            question:
                              type: string
                            options:
                              type: array
                              items:
                                type: string
                            correctIndex:
                              type: integer
                            term:
                              type: string
                            definition:
                              type: string
                            stepNumber:
                              type: integer
                            instructions:
                              type: array
                              items:
                                type: string
                            solution:
                              type: string
                            minutes:
                              type: integer
                            explanations:
                              type: array
                              items:
                                type: object
                            left:
                              type: object
                            right:
                              type: object
                            rows:
                              type: array
                              items:
                                type: array
                                items:
                                  type: string
                            children:
                              type: array
                              items:
                                type: object
      responses:
        '200':
          description: Cours créé
        '400':
          description: Erreur de validation

  /api/block-types:
    get:
      operationId: getBlockTypes
      summary: Liste des types de blocs disponibles avec exemples
      responses:
        '200':
          description: Types de blocs et exemples
